<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinity è½¬ Chrome ä¹¦ç­¾</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 1200px;
      width: 100%;
      display: flex;
      gap: 40px;
      align-items: flex-start;
    }

    .main-content {
      flex: 1;
      text-align: center;
    }

    .preview-section {
      flex: 1;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      height: 600px;
      overflow-y: auto;
      background: #f8f9fa;
    }

    .preview-section h3 {
      margin-bottom: 20px;
      color: #333;
    }

    .preview-content {
      background: white;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
      border: 1px solid #ddd;
      height: 500px;
      overflow-y: auto;
    }

    .preview-section.hidden {
      display: none;
    }

    h1 {
      color: #333;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    p {
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 12px;
      padding: 50px 20px;
      margin-bottom: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8f9ff;
    }

    .upload-area:hover {
      border-color: #764ba2;
      background: #f0f0ff;
    }

    .upload-area.dragover {
      border-color: #764ba2;
      background: #e8e4ff;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 4rem;
      color: #667eea;
      margin-bottom: 20px;
    }

    .upload-text {
      color: #666;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .upload-hint {
      color: #999;
      font-size: 0.9rem;
    }

    #fileInput {
      display: none;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 30px;
      margin-top: 12px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .download-section {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: #f8f9ff;
      border-radius: 8px;
    }

    .download-section.show {
      display: block;
    }

    .download-link {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 15px 30px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .download-link:hover {
      background: #45a049;
      transform: translateY(-2px);
    }

    .file-info {
      margin-top: 20px;
      padding: 15px;
      background: #e8f5e9;
      border-radius: 8px;
      text-align: left;
      display: none;
    }

    .file-info.show {
      display: block;
    }

    .file-info p {
      margin: 5px 0;
      color: #333;
    }

    .transform-bookmark-wrapper {
      font-size: 12px;
      color: rgb(70, 70, 75);
      line-height: 20px;
      padding: 10px;
      border-radius: 4px;
      background: rgb(245, 245, 245);
      width: 100%;
      white-space: nowrap;
    }
    .folder-sub {
      padding-left: 12px;
    }
    .transform-bookmark-wrapper  .title {
      padding-left: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .transform-bookmark-wrapper  .sub-title {
      padding-left: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="main-content">
      <h1>Infinity è½¬ Chrome ä¹¦ç­¾</h1>
      <p>ä¸Šä¼  Infinity å¯¼å‡ºçš„æ–‡ä»¶ï¼Œè½¬æ¢ä¸º Chrome æµè§ˆå™¨æ”¯æŒçš„ä¹¦ç­¾æ ¼å¼</p>

      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
        <div class="upload-hint">æ”¯æŒ .json å’Œ .infinity æ ¼å¼ (Infinity å¯¼å‡ºæ–‡ä»¶)</div>
        <input type="file" id="fileInput" accept=".json,.infinity">
      </div>

      <div class="download-section" id="downloadSection">
        <h3>è½¬æ¢å®Œæˆï¼</h3>
        <a href="#" class="download-link" id="downloadLink">ä¸‹è½½ Chrome ä¹¦ç­¾æ–‡ä»¶</a>
      </div>
    </div>

    <div class="preview-section" id="previewSection">
      <h3>è½¬æ¢é¢„è§ˆ</h3>
      <div class="preview-content" id="previewContent">è¯·ä¸Šä¼ æ–‡ä»¶è¿›è¡Œè½¬æ¢...</div>
    </div>
  </div>

  <script>
    // è¿™é‡Œå¯ä»¥æ”¾ç½®åŸºæœ¬çš„äº‹ä»¶ç›‘å¬ä»£ç ï¼Œå…·ä½“çš„è½¬æ¢é€»è¾‘ç”±ç”¨æˆ·è‡ªå·±å®ç°
    document.addEventListener('DOMContentLoaded', function () {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const convertBtn = document.getElementById('convertBtn');
      const fileInfo = document.getElementById('fileInfo');
      const fileName = document.getElementById('fileName');
      const fileSize = document.getElementById('fileSize');
      const downloadSection = document.getElementById('downloadSection');
      const downloadLink = document.getElementById('downloadLink');

      let selectedFile = null;

      // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
      uploadArea.addEventListener('click', function () {
        fileInput.click();
      });

      // æ‹–æ‹½åŠŸèƒ½
      uploadArea.addEventListener('dragover', function (e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', function () {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
          handleFile(e.dataTransfer.files[0]);
        }
      });

      // æ–‡ä»¶é€‰æ‹©
      fileInput.addEventListener('change', function (e) {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      });

      // å¤„ç†æ–‡ä»¶
      function handleFile(file) {
        if (!file.name.endsWith('.json') && !file.name.endsWith('.infinity')) {
          alert('è¯·é€‰æ‹© JSON æˆ– Infinity æ ¼å¼çš„æ–‡ä»¶');
          return;
        }

        selectedFile = file;
        
        // ç›´æ¥æ‰§è¡Œè½¬æ¢
        convertFile();
      }
      
      // è½¬æ¢æ–‡ä»¶å‡½æ•°
      function convertFile() {
        if (selectedFile) {
          // è¯»å–æ–‡ä»¶å†…å®¹
          const reader = new FileReader();
          reader.readAsText(selectedFile);
          reader.onload = function() {
              const fileContent = reader.result;
              try {
                  const jsonData = JSON.parse(fileContent);
                  console.log(jsonData);
                  console.log(jsonData.data.site.sites)
                  const sites = []
                  jsonData.data.site.sites.map(s => {
                      s.map(site => {
                          if (site.type === 'web') {
                              sites.push(site)
                          } else if (site.children && site.children.length > 0) {
                              const children = site.children.filter(c => c.type === 'web')
                              sites.push({
                                  type: 'folder',
                                  name: site.name,
                                  children: children
                              })
                          }
                      })
                  })
                  console.log(sites)
                  
                  // åœ¨å³ä¾§é¢„è§ˆåŒºåŸŸæ¸²æŸ“siteså˜é‡
                  const previewSection = document.getElementById('previewSection');
                  const previewContent = document.getElementById('previewContent');
                  
                  // å°†sitesæ ¼å¼åŒ–ä¸ºæ˜“è¯»çš„JSONæ ¼å¼
                  const formattedSites = JSON.stringify(sites, null, 2);
                  previewContent.innerHTML = `
                    <div class="transform-bookmark-wrapper">
                      ${sites.map(site => {
                        if (site.children) {
                            return `
                            <details class="details">
                              <summary>${site.name}</summary>
                              <div class="folder-sub">${site.children.map(child => `<div class="sub-title" :title="${child.name}">${child.name} </div>`).join('')}</div>
                            </details>`
                        } else {
                            return `<div class="title" :title="${site.name}">${site.name} </div>`
                        }
                      }).join('')}
                    </div>
                  `;
                  
                  // è½¬æ¢ä¸ºChromeä¹¦ç­¾HTMLæ ¼å¼
                  const bookmarkHTML = convertToChromeBookmarkHTML(sites);
                  
                  // è®¾ç½®ä¸‹è½½é“¾æ¥
                  const downloadLink = document.getElementById('downloadLink');
                  const downloadSection = document.getElementById('downloadSection');
                  
                  // æ˜¾ç¤ºä¸‹è½½åŒºåŸŸ
                  downloadSection.classList.add('show');
                  
                  // ç»‘å®šä¸‹è½½äº‹ä»¶
                  downloadLink.onclick = function (e) {
                      e.preventDefault();
                      downloadFile(bookmarkHTML, 'chrome_bookmarks.html', 'text/html');
                  };
                  
              } catch (error) {
                  console.error('JSON è§£æé”™è¯¯:', error);
                  alert('æ–‡ä»¶å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼');
              }
          }
        }
      }



      // å°†ç«™ç‚¹æ•°æ®è½¬æ¢ä¸ºChromeä¹¦ç­¾HTMLæ ¼å¼
      function convertToChromeBookmarkHTML(sites) {
        // Chromeä¹¦ç­¾HTMLæ¨¡æ¿
        const htmlTemplate = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<!-- This is an automatically generated file.
     It will be read and overwritten.
     DO NOT EDIT! -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL>
<DT>
<H3>Bookmarks</H3>
<DL><p>
${generateBookmarkEntries(sites)}
</DL><p>
</DT>
</DL>`;
        return htmlTemplate;
      }

      // ç”Ÿæˆä¹¦ç­¾æ¡ç›®
      function generateBookmarkEntries(items) {
        let html = '';

        items.forEach(item => {
          if (item.type === 'folder') {
            // æ–‡ä»¶å¤¹
            html += `<DT><H3>${item.name}</H3>
<DL><p>
`;
            if (item.children && item.children.length > 0) {
              html += generateBookmarkEntries(item.children);
            }
            html += `</DL><p>
`;
          } else {
            // å•ä¸ªä¹¦ç­¾
            const dateAdded = item.createAt ? new Date(item.createAt).getTime() / 1000 : Date.now() / 1000;
            html += `<DT><A HREF="${item.target}" ADD_DATE="${Math.floor(dateAdded)}" LAST_MODIFIED="${Math.floor(Date.now() / 1000)}" ${item.bgImage ? `ICON="${item.bgImage}"` : ''}>${item.name}</A>
`;
          }
        });

        return html;
      }

      // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
      function downloadFile(content, filename, contentType) {
        const blob = new Blob([content], { type: contentType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }


    });
  </script>
</body>

</html>